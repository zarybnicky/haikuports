# Experimental rules for building Haiku ports
# Author: Andreas FÃ¤rber <andreas.faerber@web.de>

rule PortDepends port : dependency {
	Port $(dependency) ;
	Depends $(port) : $(dependency) ;
}

rule BuildPort port
{
	Port $(port) ;
	Depends all : $(port) ;
}

rule Port port
{
	NotFile $(port) ;
	Always $(port) ;
	BUILDDIR on $(port) ?= $(BUILDROOT)/$(port) ;
}

CONFIGURE ?= configure ;

actions Configure
{
	mkdir -p "$(BUILDDIR)"
	cd "$(BUILDDIR)"
	HAIKUCPPFLAGS=" $(HAIKU_CPPFLAGS) " && export HAIKUCPPFLAGS
	HAIKULDFLAGS=" $(HAIKU_LDFLAGS) " && export HAIKULDFLAGS
	PATH=$PATH:$(PATH) \
	$(SRCDIR)/$(CONFIGURE) $(CONFIGUREFLAGS)
}

MAKE ?= make ;

actions Make
{
	cd "$(BUILDDIR)"
	HAIKUCPPFLAGS=" $(HAIKU_CPPFLAGS) " && export HAIKUCPPFLAGS
	HAIKULDFLAGS=" $(HAIKU_LDFLAGS) " && export HAIKULDFLAGS
	PATH=$PATH:$(PATH) \
	$(MAKE) $(MAKEFLAGS)
}
actions ignore MakeIgnored
{
	cd "$(BUILDDIR)"
	HAIKUCPPFLAGS=" $(HAIKU_CPPFLAGS) " && export HAIKUCPPFLAGS
	HAIKULDFLAGS=" $(HAIKU_LDFLAGS) " && export HAIKULDFLAGS
	PATH=$PATH:$(PATH) \
	$(MAKE) $(MAKEFLAGS)
}

actions MakeInstall
{
	cd "$(BUILDDIR)"
	HAIKUCPPFLAGS=" $(HAIKU_CPPFLAGS) " && export HAIKUCPPFLAGS
	HAIKULDFLAGS=" $(HAIKU_LDFLAGS) " && export HAIKULDFLAGS
	PATH=$PATH:$(PATH) \
	$(MAKE) install $(MAKEFLAGS)
}
